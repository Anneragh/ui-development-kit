<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <nz-spin nzSize="large" nzTip="Loading identity information...">
    <div class="loading-content"></div>
  </nz-spin>
</div>

<!-- Error State -->
<nz-result
  *ngIf="error && !loading"
  nzStatus="error"
  nzTitle="Error Loading Identity"
  [nzSubTitle]="error"
  nzExtra="
    <button nz-button nzType='primary' (click)='loadIdentity()'>
      <span nz-icon nzType='reload'></span>
      Retry
    </button>
  ">
</nz-result>

<!-- Main Content -->
<div *ngIf="!loading && !error && identity" class="identity-info-container">
  <!-- Header Section -->
  <div class="identity-header">
    <div class="header-content">
      <div class="identity-avatar">
        <nz-avatar nzSize="large" nzIcon="user" [nzSrc]="identity.attributes?.['photo']"></nz-avatar>
      </div>
      <div class="identity-details">
        <h1 class="identity-name">{{ identity.attributes?.displayName || identity.name }}</h1>
        <div class="identity-meta">
          <nz-tag [nzColor]="getStatusColor(identity.identityStatus)">{{ identity.identityStatus }}</nz-tag>
          <nz-tag [nzColor]="getProcessingStateColor(identity.processingState)">{{ identity.processingState }}</nz-tag>
          <span class="identity-id">ID: {{ identity.id }}</span>
        </div>
        <div class="identity-contact">
          <span *ngIf="identity.emailAddress" class="contact-item">
            <nz-icon nzType="mail"></nz-icon>
            {{ identity.emailAddress }}
          </span>
          <span *ngIf="identity.alias" class="contact-item">
            <nz-icon nzType="user"></nz-icon>
            {{ identity.alias }}
          </span>
          <span *ngIf="identity.managerRef?.name" class="contact-item">
            <nz-icon nzType="team"></nz-icon>
            Manager: {{ identity.managerRef.name }}
          </span>
        </div>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="header-actions">
      <button nz-button nzType="default" (click)="goBack()">
        <span nz-icon nzType="left"></span>
        Back
      </button>
    </div>
  </div>

  <nz-divider></nz-divider>

  <!-- Identity Information Grid -->
  <div class="identity-content">
    <nz-row [nzGutter]="[24, 24]">
      <!-- Basic Information -->
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="8">
        <nz-card nzTitle="Basic Information" [nzBordered]="false">
          <nz-descriptions nzBordered [nzColumn]="1" nzSize="small">
            <nz-descriptions-item nzTitle="First Name">
              {{ identity.attributes?.firstname || 'N/A' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Last Name">
              {{ identity.attributes?.lastname || 'N/A' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Display Name">
              {{ identity.attributes?.displayName || 'N/A' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="UID">
              {{ identity.attributes?.uid || 'N/A' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Identification Number">
              {{ identity.attributes?.identificationNumber || 'N/A' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Manager">
              {{ identity.managerRef?.name || 'N/A' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Is Manager">
              {{ identity.isManager ? 'Yes' : 'No' }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Cloud Status">
              {{ identity.attributes?.cloudStatus || 'N/A' }}
            </nz-descriptions-item>
          </nz-descriptions>
        </nz-card>
      </nz-col>

      <!-- Status & Timeline -->
      <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="8">
        <nz-card nzTitle="Status & Timeline" [nzBordered]="false">
          <div class="status-section">
            <div class="status-indicator">
              <nz-badge [nzStatus]="identity.identityStatus === 'ACTIVE' ? 'success' : 'error'" [nzText]="identity.identityStatus"></nz-badge>
            </div>
          </div>
          
          <nz-timeline class="timeline-section">
            <nz-timeline-item nzColor="blue">
              <strong>Created:</strong> {{ formatDate(identity.created) }}
            </nz-timeline-item>
            <nz-timeline-item nzColor="green">
              <strong>Last Modified:</strong> {{ formatDate(identity.modified) }}
            </nz-timeline-item>
            <nz-timeline-item nzColor="orange">
              <strong>Last Refresh:</strong> {{ formatDate(identity.lastRefresh) }}
            </nz-timeline-item>
            <nz-timeline-item nzColor="purple">
              <strong>Lifecycle State:</strong> {{ identity.lifecycleState?.stateName || 'N/A' }}
            </nz-timeline-item>
          </nz-timeline>
        </nz-card>
      </nz-col>

      <!-- Additional Attributes -->
      <nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="8">
        <nz-card nzTitle="Additional Attributes" [nzBordered]="false">
          <div class="attributes-section">
            <div *ngIf="identity?.attributes && getAttributeKeys().length > 0; else noAttributes">
              <div class="attribute-item" *ngFor="let attr of getAttributeKeys()">
                <div class="attribute-label">{{ attr }}</div>
                <div class="attribute-value">{{ getAttributeValue(attr) }}</div>
              </div>
            </div>
            <ng-template #noAttributes>
              <nz-empty nzNotFoundContent="No additional attributes available"></nz-empty>
            </ng-template>
          </div>
        </nz-card>
      </nz-col>
    </nz-row>
  </div>

  <!-- Back to Top -->
  <nz-back-top></nz-back-top>
</div>
