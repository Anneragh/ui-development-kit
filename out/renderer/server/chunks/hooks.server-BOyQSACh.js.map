{"version":3,"file":"hooks.server-BOyQSACh.js","sources":["../../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { c as checkSession, b as checkIdnSession, d as getSession, g as getToken, l as lastCheckedToken, e as getTokenDetails, f as checkToken } from \"./oauth.js\";\nimport { r as redirect } from \"./index.js\";\nconst handle = async ({ event, resolve }) => {\n  const hasSession = checkSession(event.cookies);\n  const hasIdnSession = checkIdnSession(event.cookies);\n  event.locals.hasSession = hasSession;\n  event.locals.hasIdnSession = hasIdnSession;\n  if (hasSession) {\n    event.locals.session = getSession(event.cookies);\n    if (hasIdnSession) {\n      const session = await getToken(event.cookies);\n      if (!session) {\n        event.locals.hasIdnSession = false;\n        event.locals.idnSession = void 0;\n      } else {\n        event.locals.idnSession = session;\n        const lastToken = lastCheckedToken(event.cookies);\n        const tokenDetails = getTokenDetails(event.cookies);\n        if (tokenDetails && lastToken != \"\" && lastToken === event.locals.idnSession.access_token) {\n          event.locals.tokenDetails = tokenDetails;\n        } else {\n          const tempTokenDetails = await checkToken(\n            event.locals.session.baseUrl,\n            event.locals.idnSession.access_token\n          );\n          if (tempTokenDetails) {\n            event.locals.tokenDetails = tempTokenDetails;\n            event.cookies.set(\"tokenDetails\", JSON.stringify(event.locals.tokenDetails), {\n              path: \"/\",\n              httpOnly: false,\n              secure: false\n            });\n          }\n        }\n      }\n    }\n  }\n  if (event.url.pathname.startsWith(\"/home\") || event.url.pathname.startsWith(\"/api\")) {\n    if (!hasSession || !hasIdnSession) {\n      redirect(302, \"/\");\n    }\n  }\n  const response = await resolve(event);\n  return response;\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEK,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,MAAM,UAAU,GAAG,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACjD,EAAE,MAAM,aAAa,GAAG,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACvD,EAAE,KAAK,CAAC,MAAM,CAAC,UAAU,GAAG,UAAU,CAAC;AACvC,EAAE,KAAK,CAAC,MAAM,CAAC,aAAa,GAAG,aAAa,CAAC;AAC7C,EAAE,IAAI,UAAU,EAAE;AAClB,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACrD,IAAI,IAAI,aAAa,EAAE;AACvB,MAAM,MAAM,OAAO,GAAG,MAAM,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACpD,MAAM,IAAI,CAAC,OAAO,EAAE;AACpB,QAAQ,KAAK,CAAC,MAAM,CAAC,aAAa,GAAG,KAAK,CAAC;AAC3C,QAAQ,KAAK,CAAC,MAAM,CAAC,UAAU,GAAG,KAAK,CAAC,CAAC;AACzC,OAAO,MAAM;AACb,QAAQ,KAAK,CAAC,MAAM,CAAC,UAAU,GAAG,OAAO,CAAC;AAC1C,QAAQ,MAAM,SAAS,GAAG,gBAAgB,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AAC1D,QAAQ,MAAM,YAAY,GAAG,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AAC5D,QAAQ,IAAI,YAAY,IAAI,SAAS,IAAI,EAAE,IAAI,SAAS,KAAK,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY,EAAE;AACnG,UAAU,KAAK,CAAC,MAAM,CAAC,YAAY,GAAG,YAAY,CAAC;AACnD,SAAS,MAAM;AACf,UAAU,MAAM,gBAAgB,GAAG,MAAM,UAAU;AACnD,YAAY,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO;AACxC,YAAY,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY;AAChD,WAAW,CAAC;AACZ,UAAU,IAAI,gBAAgB,EAAE;AAChC,YAAY,KAAK,CAAC,MAAM,CAAC,YAAY,GAAG,gBAAgB,CAAC;AACzD,YAAY,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE;AACzF,cAAc,IAAI,EAAE,GAAG;AACvB,cAAc,QAAQ,EAAE,KAAK;AAC7B,cAAc,MAAM,EAAE,KAAK;AAC3B,aAAa,CAAC,CAAC;AACf,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK;AACL,GAAG;AACH,EAAE,IAAI,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;AACvF,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,aAAa,EAAE;AACvC,MAAM,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACzB,KAAK;AACL,GAAG;AACH,EAAE,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,KAAK,CAAC,CAAC;AACxC,EAAE,OAAO,QAAQ,CAAC;AAClB;;;;"}