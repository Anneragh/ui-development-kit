{"version":3,"file":"10-BJLzw-es.js","sources":["../../../../.svelte-kit/adapter-node/entries/pages/home/example-pages/source-aggregations/_page.server.ts.js","../../../../.svelte-kit/adapter-node/nodes/10.js"],"sourcesContent":["import { g as getPage, i as getFilters, e as getLimit, h as getSorters } from \"../../../../../chunks/Utils.js\";\nimport { c as createConfiguration } from \"../../../../../chunks/sdk.js\";\nimport { g as getToken } from \"../../../../../chunks/oauth.js\";\nimport { SourcesApi, SearchApi } from \"sailpoint-api-client\";\nconst load = async ({ cookies, url }) => {\n  const session = JSON.parse(cookies.get(\"session\"));\n  const idnSession = await getToken(cookies);\n  const config = createConfiguration(session.baseUrl, idnSession.access_token);\n  const sourceApi = new SourcesApi(config);\n  const searchApi = new SearchApi(config);\n  const page = getPage(url);\n  const filters = getFilters(url);\n  const limit = getLimit(url);\n  const sorters = getSorters(url);\n  const requestParams = {\n    filters,\n    offset: Number(page) * Number(limit),\n    limit: Number(limit),\n    sorters,\n    count: true\n  };\n  const apiResponse = sourceApi.listSources(requestParams);\n  const sources = new Promise((resolve) => {\n    apiResponse.then((response) => {\n      resolve(response.data);\n    }).catch((err) => {\n      throw err;\n    });\n  });\n  const totalCount = new Promise((resolve) => {\n    apiResponse.then((response) => {\n      resolve(response.headers[\"x-total-count\"]);\n    }).catch((err) => {\n      throw err;\n    });\n  });\n  const eventNames = [\n    \"Aggregate Source Account Passed\",\n    \"Aggregate Source Account Started\",\n    \"Aggregate Source Entitlement Passed\",\n    \"Aggregate Source Entitlement Started\"\n  ];\n  const eventsMap = new Promise((resolve) => {\n    sources.then(async (sources2) => {\n      const sourceEventsMap = /* @__PURE__ */ new Map();\n      for (const source of sources2) {\n        const allEvents = [];\n        const promises = [];\n        for (const event of eventNames) {\n          const search = {\n            indices: [\"events\"],\n            query: {\n              query: `target.name: \"${source.name}\" AND name:\"${event}\"`\n            },\n            sort: [\"created\"]\n          };\n          promises.push(\n            searchApi.searchPost({\n              search\n            }).then((response) => {\n              return response.data;\n            }).catch((err) => {\n              throw err;\n            })\n          );\n        }\n        await Promise.allSettled(promises).then((results) => {\n          for (const event of results) {\n            if (event.status == \"fulfilled\" && event.value.length > 0) {\n              allEvents.push(event.value[0]);\n            }\n          }\n          const sourceEvents = {\n            accounts: { started: void 0, passed: void 0 },\n            entitlements: { started: void 0, passed: void 0 }\n          };\n          for (const event of allEvents) {\n            if (event.attributes.sourceName === source.name) {\n              switch (event.technicalName) {\n                case \"SOURCE_ACCOUNT_AGGREGATE_STARTED\":\n                  if (!sourceEvents.accounts.started) {\n                    sourceEvents.accounts.started = event || void 0;\n                  }\n                  break;\n                case \"SOURCE_ACCOUNT_AGGREGATE_PASSED\":\n                  if (!sourceEvents.accounts.passed) {\n                    sourceEvents.accounts.passed = event || void 0;\n                  }\n                  break;\n                case \"SOURCE_ENTITLEMENT_AGGREGATE_STARTED\":\n                  if (!sourceEvents.entitlements.started) {\n                    sourceEvents.entitlements.started = event || void 0;\n                  }\n                  break;\n                case \"SOURCE_ENTITLEMENT_AGGREGATE_PASSED\":\n                  if (!sourceEvents.entitlements.passed) {\n                    sourceEvents.entitlements.passed = event || void 0;\n                  }\n                  break;\n              }\n            }\n          }\n          sourceEventsMap.set(source.name, sourceEvents);\n        });\n      }\n      resolve(sourceEventsMap);\n    });\n  });\n  return { sources, eventsMap, totalCount, params: { page, limit, filters, sorters } };\n};\nexport {\n  load\n};\n","import * as server from '../entries/pages/home/example-pages/source-aggregations/_page.server.ts.js';\n\nexport const index = 10;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/home/example-pages/source-aggregations/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/home/example-pages/source-aggregations/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/10.BxdKtH0u.js\",\"_app/immutable/chunks/scheduler.fBTsnP2i.js\",\"_app/immutable/chunks/Progress.3ESwaKmp.js\",\"_app/immutable/chunks/index.DdnDjIf5.js\",\"_app/immutable/chunks/ProgressBar.svelte_svelte_type_style_lang.DcCzH8ar.js\",\"_app/immutable/chunks/index.D97w0myq.js\",\"_app/immutable/chunks/each.C9vk03ly.js\",\"_app/immutable/chunks/Utils.BOVa1qxf.js\",\"_app/immutable/chunks/entry.Cs_QM1XO.js\"];\nexport const stylesheets = [\"_app/immutable/assets/ProgressBar.DtHVHfix.css\"];\nexport const fonts = [];\n"],"names":["SourcesApi","SearchApi"],"mappings":"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"}